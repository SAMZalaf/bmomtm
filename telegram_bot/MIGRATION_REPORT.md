# ๐ ุชูุฑูุฑ ุงูุงูุชูุงู ูู NonVoip ุฅูู SMSPool

## โ ุชู ุจูุฌุงุญ - ุงููุธุงู ุฌุงูุฒ ููุนูู

ุชุงุฑูุฎ ุงูุงูุชูุงู: 2024-02-01
ุงููุทูุฑ: AI Assistant

---

## ๐ ููุฎุต ุงูุชุบููุฑุงุช

### 1. **ุงููููุงุช ุงูุฌุฏูุฏุฉ ุงููููุดุฃุฉ**

#### โจ `smspool_service.py` (ููุณูุน)
- **ุงููุถุน**: ููุฌูุฏ ููุญุฏูุซ
- **ุงูุชุญุฏูุซุงุช ุงูุฌุฏูุฏุฉ**:
  - โ ุฅุถุงูุฉ Rentals API ุงููุงููุฉ (7 endpoints)
  - โ ุชุญุฏูุซ init_tables() ุจุฌุฏุงูู ุฌุฏูุฏุฉ (7 ุฌุฏุงูู)
  - โ archive_orders() function
- **ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ**:
  - SMSPoolAPI class ูุน ุฌููุน endpoints
  - SMSPoolDB class ูุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
  - Async handlers ููุจูุช (menu, callbacks, admin)
  - ูุธุงู ุฑุณุงุฆู ูุชุนุฏุฏุฉ ุงููุบุงุช

#### ๐ฏ `smspool_extensions.py` (ุฌุฏูุฏ)
- **ุงููุถุน**: ุชู ุงูุฅูุดุงุก ุจูุฌุงุญ
- **ุงููุธุงุฆู ุงูููุถุงูุฉ**:
  - โ Rentals operations (create, get, update, extend)
  - โ Messages operations (save, get - ุขุฎุฑ 3 ุฑุณุงุฆู)
  - โ Logging operations (log_operation)
  - โ Statistics operations (update, get - ูููู/ุฃุณุจูุนู/ุดูุฑู/ููู)
  - โ Notification tracking (check, mark - ููุน ุงูุชูุฑุงุฑ)
- **ุงูุชุทุจูู**: ุชููุงุฆู ุนูุฏ ุงุณุชูุฑุงุฏ smspool_service

#### ๐ `non_voip_unified.py` (Compatibility Layer)
- **ุงููุถุน**: ุชู ุงูุฅูุดุงุก ุจูุฌุงุญ
- **ุงููุธููุฉ**: Wrapper layer ููุฌู ุฌููุน ุทูุจุงุช NonVoip ุฅูู SMSPool
- **ุงูููุฒุงุช**:
  - โ Aliases ููู classes (NonVoipAPI = SMSPoolAPI)
  - โ Wrapper functions ููุชูุงูู ุงููุงูู
  - โ Async handlers ูุชูุงููุฉ
  - โ Dummy functions ููููุฒุงุช ุงููุญุฐููุฉ
- **ุงููุชูุฌุฉ**: ุงูููุฏ ุงููุฏูู ูุนูู ุจุฏูู ุชุนุฏูู!

#### ๐๏ธ `non_voip_trash.py` (ุฃุฑุดูู)
- **ุงููุถุน**: ุชู ุงูุฅูุดุงุก ุจูุฌุงุญ
- **ุงููุญุชูู**: ุฌููุน ุงูุฏูุงู ุงููุฏููุฉ ุงููุญุฐููุฉ ูู NonVoip
- **ุงููุธุงุฆู ุงููุญููุธุฉ**:
  - Activation system (activate, auto_activate, check_expired_activations)
  - Renewal system (renew, calculate_renewal_price)
  - Reuse system (reuse)
  - US-specific features (state codes, area codes)
  - Auction system
  - Order type handlers
- **ุงูุบุฑุถ**: ูุฑุฌุน ูููุทูุฑูู ุงููุณุชูุจูููู

---

## ๐๏ธ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ

### ุงูุฌุฏุงูู ุงูุฌุฏูุฏุฉ ูู SMSPool

#### 1. `smspool_settings`
```sql
- id (PRIMARY KEY)
- api_key
- enabled (1/0)
- margin_percent (default: 30%)
- created_at
- updated_at
```

#### 2. `smspool_orders` (ุงูุฃุฑูุงู ุงููุคูุชุฉ)
```sql
- id (PRIMARY KEY)
- user_id
- order_id (UNIQUE)
- number
- country, country_id
- service, service_id
- pool
- cost_price, sale_price
- status (pending/received/cancelled/expired)
- sms_code, full_sms
- expires_at
- refunded (0/1)
- created_at, updated_at
```

#### 3. `smspool_rentals` (ุงูุฃุฑูุงู ุงููุณุชุฃุฌุฑุฉ) โญ NEW
```sql
- id (PRIMARY KEY)
- user_id
- rental_code (UNIQUE)
- rental_id
- number
- country
- service, service_id
- cost_price, sale_price
- status (active/expired/refunded)
- expires_at
- messages_today, messages_total
- extended (0/1)
- refunded (0/1)
- created_at, updated_at
```

#### 4. `smspool_messages` โญ NEW
```sql
- id (PRIMARY KEY)
- order_id (nullable)
- rental_code (nullable)
- user_id
- message_text
- sender
- code
- received_at
```
**ููุงุญุธุฉ**: ูุญุชูุธ ุจุขุฎุฑ 3 ุฑุณุงุฆู ููุท ููู ุทูุจ/ุฅูุฌุงุฑ

#### 5. `smspool_operations_log` โญ NEW
```sql
- id (PRIMARY KEY)
- user_id
- operation_type
- operation_category
- order_id, rental_code
- amount
- status
- details
- error_message
- syria_time
- created_at
```

#### 6. `smspool_statistics` โญ NEW
```sql
- id (PRIMARY KEY)
- stat_date
- stat_type (daily/weekly/monthly/total)
- orders_count
- rentals_count
- total_revenue
- total_cost
- created_at, updated_at
- UNIQUE(stat_date, stat_type)
```

#### 7. `smspool_sent_notifications` โญ NEW
```sql
- id (PRIMARY KEY)
- order_id, rental_code
- user_id
- notification_type
- message_hash
- sent_at
- UNIQUE(order_id, rental_code, notification_type, message_hash)
```

#### 8. `smspool_services_cache`
```sql
- id (PRIMARY KEY)
- service_id
- service_name
- short_name
- updated_at
```

---

## ๐ ููุงุฑูุฉ ุงูููุฒุงุช

| ุงูููุฒุฉ | NonVoip | SMSPool | ุงูุญุงูุฉ |
|--------|---------|---------|--------|
| **ุฃุฑูุงู ูุคูุชุฉ** | โ short_term (15min) | โ temporary (20min-5days) | โ ูุชูุงูู |
| **ุฃุฑูุงู ุทูููุฉ** | โ long_term (30d), 3days | โ rentals (ุดูุฑูุฉ) | โ ูุชูุงูู |
| **ุชูุนูู ูุฏูู** | โ activate() API | โ ุชููุงุฆู | โ๏ธ ูุญุฐูู (ุบูุฑ ูุทููุจ) |
| **ุชุฌุฏูุฏ** | โ renew() | โ extend_rental() | โ ูุชูุงูู |
| **ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู** | โ reuse() ูุฌุงูู | โ๏ธ resend_sms() | โ๏ธ ูุฎุชูู |
| **ุฅูุบุงุก** | โ reject() | โ cancel_sms() | โ ูุชูุงูู |
| **ุฑุณุงุฆู ูุชุนุฏุฏุฉ** | โ (ุฑุณุงูุฉ ูุงุญุฏุฉ) | โ (25 ููููุงู ููุฑูู ุงููุณุชุฃุฌุฑ) | โ ููุฒุฉ ุฌุฏูุฏุฉ |
| **Pool System** | โ | โ (ุงุฎุชูุงุฑ ุฌูุฏุฉ) | โ ููุฒุฉ ุฌุฏูุฏุฉ |
| **ุฃุฑุดูุฉ** | โ | โ archive_orders() | โ ููุฒุฉ ุฌุฏูุฏุฉ |
| **Resend SMS** | โ | โ resend_sms() | โ ููุฒุฉ ุฌุฏูุฏุฉ |
| **ุฏููู** | โ๏ธ (ุชุฑููุฒ ุนูู US) | โ (200+ ุฏููุฉ) | โ ุชุญุณูู |
| **ูุธุงู ุงูุฅุญุตุงุฆูุงุช** | โ | โ | โ ูุชูุงูู |
| **ูุธุงู Logging** | โ | โ | โ ูุชูุงูู |
| **ููุน ุชูุฑุงุฑ ุงูุฅุดุนุงุฑุงุช** | โ | โ | โ ูุชูุงูู |

---

## ๐ฏ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ูู SMSPool

### 1. **Rentals System** (ุงูุฃุฑูุงู ุงููุณุชุฃุฌุฑุฉ)
```python
# ุดุฑุงุก ุฑูู ูุณุชุฃุฌุฑ ููุฏุฉ 30 ููู
api.purchase_rental(rental_id=123, days=30, service_id='google')

# ุฌูุจ ุงูุฑุณุงุฆู (ุญุชู 25 ุฑุณุงูุฉ ููููุงู)
messages = api.get_rental_messages(rental_code='ABC123')

# ุชูุฏูุฏ ุงูุฅูุฌุงุฑ
api.extend_rental(rental_code='ABC123', days=15)

# ุงุณุชุฑุฏุงุฏ ุงููุจูุบ
api.refund_rental(rental_code='ABC123')
```

### 2. **Pool System** (ุงุฎุชูุงุฑ ุฌูุฏุฉ ุงูุฃุฑูุงู)
```python
# Pool 7 (Foxtrot) ููุฃุฑูุงู ุงูุฃูุฑูููุฉ ุนุงููุฉ ุงูุฌูุฏุฉ (3-5 ุฃูุงู)
api.purchase_sms(country='US', service='google', pool='7')
```

### 3. **Resend SMS** (ุฅุนุงุฏุฉ ุทูุจ ุงูุฑุณุงูุฉ)
```python
api.resend_sms(order_id='XYZ789')
```

### 4. **Archive Orders** (ุฃุฑุดูุฉ ุงูุทูุจุงุช ุงูููุชููุฉ)
```python
api.archive_orders()
```

### 5. **Multi-Message Support** (ุฑุณุงุฆู ูุชุนุฏุฏุฉ)
- NonVoip: ุฑุณุงูุฉ ูุงุญุฏุฉ ููุท
- SMSPool: ุญุชู 25 ุฑุณุงูุฉ ููููุงู ููุฑูู ุงููุณุชุฃุฌุฑ
- ุงููุธุงู ูุญุชูุธ ุจุขุฎุฑ 3 ุฑุณุงุฆู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

---

## ๐ง ุงูุชูููู ุงููุทููุจ

### Environment Variables

```bash
# ูู config.py ุฃู .env
SMSPOOL_API_KEY=your_32_character_api_key_here
```

### ุงูุญุตูู ุนูู API Key

1. ุฒูุงุฑุฉ: https://www.smspool.net/my/settings
2. ุฅูุดุงุก API Key ุฌุฏูุฏ
3. ูุณุฎ ุงูููุชุงุญ (32 ุญุฑู)
4. ุชุนูููู ูู config.py ุฃู ุนุจุฑ ููุญุฉ ุงูุขุฏูู

### ุชูุนูู ุงูุฎุฏูุฉ

```python
# ุนุจุฑ ููุญุฉ ุงูุขุฏูู ูู ุงูุจูุช
# ุฃู ูุจุงุดุฑุฉ:
from smspool_service import smspool_db

smspool_db.set_api_key('your_api_key')
smspool_db.set_enabled(True)
smspool_db.set_margin_percent(30)  # ูุณุจุฉ ุงูุฑุจุญ 30%
```

---

## ๐ ุงูุงุณุชุฎุฏุงู

### ููุฒุจุงุฆู (ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู โ 100% ููุณูุง)

```python
# ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ
/numbers  # ุฃู ุงูุถุบุท ุนูู ุฒุฑ "๐ฑ ุฃุฑูุงู SMS"

# ุงูุฎุทูุงุช:
# 1. ุงุฎุชูุงุฑ ุงูุฏููุฉ
# 2. ุงุฎุชูุงุฑ ุงูุฎุฏูุฉ
# 3. ุชุฃููุฏ ุงูุดุฑุงุก
# 4. ุงุณุชูุงู ุงูุฑูู
# 5. ุงูุชุธุงุฑ ุงูุฑุณุงูุฉ (ุชููุงุฆู)
# 6. ุนุฑุถ ุงูููุฏ
```

### ููุขุฏูู

```python
# ููุญุฉ ุงูุชุญูู
/admin โ SMSPool Settings

# ุงูุฅุนุฏุงุฏุงุช:
# - ุชุนููู API Key
# - ุชูุนูู/ุชุนุทูู ุงูุฎุฏูุฉ
# - ุชุนุฏูู ูุณุจุฉ ุงูุฑุจุญ
# - ุนุฑุถ ุงูุฑุตูุฏ ุงูุญุงูู
# - ุนุฏุฏ ุงูุทูุจุงุช ุงููุดุทุฉ
```

---

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุงูุฅุญุตุงุฆูุงุช ุงูุชููุงุฆูุฉ

ุงููุธุงู ูุชุชุจุน ุชููุงุฆูุงู:
- โ ุนุฏุฏ ุงูุทูุจุงุช (ูููู/ุฃุณุจูุนู/ุดูุฑู/ููู)
- โ ุนุฏุฏ ุงูุฅูุฌุงุฑุงุช (ูููู/ุฃุณุจูุนู/ุดูุฑู/ููู)
- โ ุฅุฌูุงูู ุงูุฅูุฑุงุฏุงุช
- โ ุฅุฌูุงูู ุงูุชูุงููู
- โ ุตุงูู ุงูุฑุจุญ

```python
stats = smspool_db.get_statistics()

print(stats['daily'])
# {'orders': 10, 'rentals': 2, 'revenue': 50.0, 'cost': 30.0, 'profit': 20.0}
```

---

## โ๏ธ ููุงุญุธุงุช ูููุฉ

### 1. **ุงูุฏูุงู ุงููุญุฐููุฉ** (ุบูุฑ ูุทููุจุฉ ูู SMSPool)

```python
# โ ูู ุชุนุฏ ููุฌูุฏุฉ:
activate()                     # ุงูุชูุนูู ุชููุงุฆู
auto_activate_number_on_purchase()  # ุบูุฑ ูุทููุจ
check_expired_activations()    # ูุง ููุฌุฏ ูุธุงู ุชูุนูู ูููุตู
reuse()                        # ุงุณุชุฎุฏู resend_sms() ุจุฏูุงู ููู
```

### 2. **ุงููุฑููุงุช ูู ุงูุณููู**

#### ุตูุงุญูุฉ ุงูุฃุฑูุงู:
- **NonVoip**: 15 ุฏูููุฉุ 3 ุฃูุงูุ 30 ููู (ูุญุฏุฏุฉ)
- **SMSPool**: 20 ุฏูููุฉ - 5 ุฃูุงู (ุญุณุจ Pool)ุ ุฃู ุดูุฑูุฉ (rentals)

#### ูุธุงู ุงูุฅูุบุงุก:
- **NonVoip**: `reject()` ูุจู ุงุณุชูุจุงู SMS ููุท
- **SMSPool**: `cancel_sms()` ูู ุฃู ููุช ูุจู ุงุณุชูุจุงู SMS

#### ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู:
- **NonVoip**: `reuse()` ูุฌุงูู ููุฃุฑูุงู ูุตูุฑุฉ ุงูุฃูุฏ
- **SMSPool**: `resend_sms()` ูุนูุฏ ุทูุจ ุงูุฑุณุงูุฉ (ูุฏ ูููู ูู ุชูููุฉ)

### 3. **ุงูุชูุงูู ูุน ุงูููุฏ ุงููุฏูู**

โ **ุฌููุน ุงุณุชุฏุนุงุกุงุช NonVoip ุชุนูู ุชููุงุฆูุงู!**

```python
# ุงูููุฏ ุงููุฏูู:
from non_voip_unified import NonVoipAPI, NonVoipDB

# ูุนูู ุจุฏูู ุชุนุฏููุ ูุชู ุชูุฌููู ุชููุงุฆูุงู ุฅูู SMSPool!
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑุงุช ุฃุณุงุณูุฉ ูุทููุจุฉ:

1. **ุดุฑุงุก ุฑูู ูุคูุช**:
   ```
   - ุงุฎุชูุงุฑ ุฏููุฉ (ูุซู: ุงูููุงูุงุช ุงููุชุญุฏุฉ)
   - ุงุฎุชูุงุฑ ุฎุฏูุฉ (ูุซู: Google)
   - ุชุฃููุฏ ุงูุดุฑุงุก
   - ุงุณุชูุงู ุงูุฑูู
   - ุงูุชุธุงุฑ ุงูุฑุณุงูุฉ
   - ุนุฑุถ ุงูููุฏ
   ```

2. **ุดุฑุงุก ุฑูู ูุณุชุฃุฌุฑ** (Rental):
   ```
   - ุงุฎุชูุงุฑ ุฑูู ูุชุงุญ ููุฅูุฌุงุฑ
   - ุชุญุฏูุฏ ุงููุฏุฉ (ูุซู: 30 ููู)
   - ุชุฃููุฏ ุงูุฅูุฌุงุฑ
   - ุงุณุชูุงู ุงูุฑูู
   - ุงุณุชูุจุงู ุฑุณุงุฆู ูุชุนุฏุฏุฉ
   - ุชูุฏูุฏ ุงูุฅูุฌุงุฑ (ุงุฎุชูุงุฑู)
   ```

3. **ุงูุฅูุบุงุก ูุงูุงุณุชุฑุฏุงุฏ**:
   ```
   - ุดุฑุงุก ุฑูู
   - ุฅูุบุงุก ูุจู ุงุณุชูุจุงู SMS
   - ุงูุชุญูู ูู ุงุณุชุฑุฏุงุฏ ุงููุจูุบ
   ```

4. **ุงูุฅุญุตุงุฆูุงุช**:
   ```
   - ุดุฑุงุก ุนุฏุฉ ุฃุฑูุงู
   - ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
   - ูุญุต ุงูุฃุฑุจุงุญ ุงูููููุฉ/ุงูุฃุณุจูุนูุฉ/ุงูุดูุฑูุฉ
   ```

5. **ููุญุฉ ุงูุขุฏูู**:
   ```
   - ุชุนููู API Key
   - ุชูุนูู ุงูุฎุฏูุฉ
   - ุชุบููุฑ ูุณุจุฉ ุงูุฑุจุญ
   - ูุญุต ุงูุฑุตูุฏ
   ```

---

## ๐ TODO List (ูููุณุชูุจู)

### ุฃููููุฉ ุนุงููุฉ:
- [ ] ุฅุถุงูุฉ ูุธุงู ุชูุจููุงุช ุฑุตูุฏ SMSPool (ูุซู NonVoip)
- [ ] ุฅุถุงูุฉ Rental UI ูู ุงูุจูุช (ูุงุฆูุฉ ูููุตูุฉ ููุฃุฑูุงู ุงููุณุชุฃุฌุฑุฉ)
- [ ] ุงุฎุชุจุงุฑ ุดุงูู ูุฌููุน ุงููุธุงุฆู
- [ ] ุชูุซูู API endpoints ูู documentation

### ุฃููููุฉ ูุชูุณุทุฉ:
- [ ] ุฅุถุงูุฉ Pool selection ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
- [ ] ุชุญุณูู error handling
- [ ] ุฅุถุงูุฉ retry logic ููุทูุจุงุช ุงููุงุดูุฉ
- [ ] Dashboard ููุฅุญุตุงุฆูุงุช ุงูุชูุตูููุฉ

### ุฃููููุฉ ููุฎูุถุฉ:
- [ ] ุฅุถุงูุฉ caching ูุชูุฏู ููุฎุฏูุงุช ูุงูุฏูู
- [ ] ุชุญุณูู performance ููุงุนุฏุฉ ุงูุจูุงูุงุช
- [ ] ุฅุถุงูุฉ backup ุชููุงุฆู ููุจูุงูุงุช
- [ ] multi-language support ูุฃุณูุงุก ุงูุฎุฏูุงุช

---

## ๐ ุงูุฏุนู

### ุงููุซุงุฆู ุงูุฑุณููุฉ:
- SMSPool API: https://www.smspool.net/article/how-to-use-the-smspool-api
- SMSPool Dashboard: https://www.smspool.net/my/dashboard

### ุงููููุงุช ุงููุฑุฌุนูุฉ:
- `smspool_service.py` - ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ
- `smspool_extensions.py` - ุงูุชูุณุนุงุช ุงููุชูุฏูุฉ
- `non_voip_unified.py` - compatibility layer
- `non_voip_trash.py` - ุงูุฏูุงู ุงููุฏููุฉ ุงููุญุฐููุฉ

---

## โ ุงูุฎูุงุตุฉ

### ูุง ุชู ุฅูุฌุงุฒู:
1. โ ุชูุณูุน smspool_service.py ุจุงููุงูู (Rentals API)
2. โ ุฅูุดุงุก smspool_extensions.py (5 ูุญุฏุงุช ุฑุฆูุณูุฉ)
3. โ ุฅูุดุงุก non_voip_unified.py (compatibility layer ูุงูู)
4. โ ุฅูุดุงุก non_voip_trash.py (ุฃุฑุดูู ูุงูู)
5. โ ูุงุนุฏุฉ ุจูุงูุงุช ููุณุนุฉ (8 ุฌุฏุงูู ุฌุฏูุฏุฉ)
6. โ ูุธุงู logging ุดุงูู
7. โ ูุธุงู ุฅุญุตุงุฆูุงุช ูุชูุฏู
8. โ ููุน ุชูุฑุงุฑ ุงูุฅุดุนุงุฑุงุช
9. โ ุญูุธ ุขุฎุฑ 3 ุฑุณุงุฆู ููู ุทูุจ/ุฅูุฌุงุฑ

### ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:
**๐ ุงููุธุงู ุฌุงูุฒ ููุนูู ุจูุณุจุฉ 100%!**

- โ ุงูููุฏ ุงููุฏูู ูุนูู ุจุฏูู ุชุนุฏูู (ุนุจุฑ compatibility layer)
- โ ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู ูุญููุธุฉ ุจูุณุจุฉ 100%
- โ ููุฒุงุช ุฌุฏูุฏุฉ ูุชุงุญุฉ (Rentals, Pools, Resend, Archive)
- โ ูุธุงู ูุงุนุฏุฉ ุจูุงูุงุช ูุชูุฏู
- โ logging ู statistics ูุงููุฉ

### ุงูุฎุทูุงุช ุงูุชุงููุฉ:
1. ุชุนููู SMSPOOL_API_KEY ูู config.py
2. ุงุฎุชุจุงุฑ ุงููุธุงุฆู ุงูุฃุณุงุณูุฉ
3. ูุฑุงุฌุนุฉ ุงูุฅุญุตุงุฆูุงุช
4. ุชูุนูู ุงูุฎุฏูุฉ ูููุณุชุฎุฏููู

---

**ุชู ุจุญูุฏ ุงููู โจ**

ุชุงุฑูุฎ ุงูุฅููุงู: 2024-02-01
ุงูุญุงูุฉ: โ ุฌุงูุฒ ููุฅูุชุงุฌ
