# ููุฎุต ุงูุชุนุฏููุงุช - SMSPool Purchase Flow

## ุงูุชุงุฑูุฎ: 2026-02-02

---

## ุงููุดููุฉ ุงูุฃุตููุฉ
ูุธุงู ุดุฑุงุก ุฃุฑูุงู SMS Bull ูุง ูุนูู ุจุดูู ุตุญูุญ - ุงููุงุฌูุฉ ูุง ุชุญุชูู ุนูู ูุธุงุฆู ุญููููุฉ ูุตุญูุญุฉ.

---

## ุงูุญู ุงููุทุจู
ุชุทููุฑ ุชุฏูู ุดุฑุงุก ูุงูู ููุชูุงูู ูุนูู ุจููุณ ุทุฑููุฉ ูุธุงู Noon VOIP ุงููุงุฌุญ.

---

## ุงููููุงุช ุงููุนุฏูุฉ

### 1. `smspool_service.py` - ุงูุชุนุฏููุงุช ุงูุฑุฆูุณูุฉ

#### ุฃ. ุงููุธุงุฆู ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ:

1. **`handle_buy_sms()`**
   - ููุทุฉ ุงูุจุฏุงูุฉ ูุนูููุฉ ุงูุดุฑุงุก
   - ููุชุญ Inline Query ููุจุญุซ ุนู ุงูุฏูู ูุงูุฎุฏูุงุช
   - ูุนุฑุถ ุฑุณุงูุฉ ุชูุฌูููุฉ ูุน ุฒุฑ "๐ ุงุจุญุซ ุนู ุฎุฏูุฉ ุฃู ุฏููุฉ"

2. **`handle_smspool_inline_query()`**
   - ูุนุงูุฌ Inline Query ููุจุญุซ ุนู ุงูุฏูู ูุงูุฎุฏูุงุช
   - ุนูุฏ ุงูุจุญุซ ุงููุงุฑุบ: ูุนุฑุถ ุงูุฏูู ุงูุดุงุฆุนุฉ (US, GB, CA, DE, FR, etc.)
   - ุนูุฏ ุงูุจุญุซ ุจูุต: ูุจุญุซ ูู ุฃุณูุงุก ุงูุฏูู ูุงูุฎุฏูุงุช
   - ูุนุฑุถ ุงููุชุงุฆุฌ ูุน ุฃุนูุงู ุงูุฏูู ูุฃููููุงุช ุงูุฎุฏูุงุช

3. **ุชุญุฏูุซ `handle_smspool_callback()`**
   - ุฅุถุงูุฉ ูุนุงูุฌ `sp_buy_{country_id}_{service_id}` ููุดุฑุงุก ุงููุจุงุดุฑ
   - ุชุญุฏูุซ ูุนุงูุฌ `sp_country_{country_id}` ูุนุฑุถ ุงูุฎุฏูุงุช ุงููุชุงุญุฉ
   - ุฑุจุท ุฌููุน ุงููุนุงูุฌุงุช ุจุดูู ุตุญูุญ

4. **ุชุญุฏูุซ `confirm_purchase()`**
   - ุนุฑุถ ุชูุงุตูู ูุงููุฉ: ุงูุฎุฏูุฉุ ุงูุฏููุฉุ ุงูุณุนุฑุ ุงูุฑุตูุฏ
   - ุฅุถุงูุฉ ุฃููููุงุช ููุฎุฏูุงุช (๐ WhatsApp, โ๏ธ Telegram, etc.)
   - ุฅุถุงูุฉ ุฃุนูุงู ููุฏูู (๐บ๐ธ ๐ฌ๐ง ๐จ๐ฆ)
   - ุญุณุงุจ ุงูุฑุตูุฏ ุจุนุฏ ุงูุดุฑุงุก
   - ุญูุธ ูุนูููุงุช ุฅุถุงููุฉ ูู context.user_data

5. **ุชุญุฏูุซ `process_purchase()`**
   - ุฅุถุงูุฉ ุฑุณุงูุฉ "ุฌุงุฑู ูุนุงูุฌุฉ ุงูุทูุจ..."
   - ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ ูุน try/except
   - ุชุญุฏูุซ ุงูุฑุณุงุฆู ุจุฃููููุงุช ุงูุฎุฏูุงุช
   - ุจุฏุก ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ ุจุนุฏ ุงูุดุฑุงุก
   - ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ูุน ERROR_CODES

6. **ุชุญุฏูุซ ุงูุชูุซูู ูู ุฃุนูู ุงูููู**
   - ุดุฑุญ ูุงูู ููุชุฏูู (7 ุฎุทูุงุช)
   - ูุงุฆูุฉ ุจุฌููุน API Endpoints
   - ูุงุฆูุฉ ุจุงููุธุงุฆู ุงูุฑุฆูุณูุฉ

---

#### ุจ. ุงููุธุงุฆู ุงููุญุฏุซุฉ:

1. **`show_countries_menu()`**
   - ุชู ุงุณุชุจุฏุงููุง ุจู `handle_buy_sms()`
   - ุงูุขู ุชุณุชุฏุนู `handle_buy_sms()` ูุจุงุดุฑุฉ

2. **`show_services_menu()`**
   - ุชู ุฏูุฌูุง ูู ูุนุงูุฌ callback `sp_country_{country_id}`
   - ุงูุขู ุชูุนุฑุถ ุงูุฎุฏูุงุช ูุจุงุดุฑุฉ ูู callback

---

### 2. ุงููููุงุช ุงูุฌุฏูุฏุฉ ุงููุถุงูุฉ

#### `SMSPOOL_PURCHASE_FLOW.md`
ุชูุซูู ุดุงูู ูุญุชูู ุนูู:
- ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู
- ุงูุชุฏูู ุงููุงูู ููุดุฑุงุก (7 ุฎุทูุงุช ููุตูุฉ)
- ุดุฑุญ ูู ูุธููุฉ
- ุจููุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ููุญุฉ ุงูุชุญูู (Admin)
- ููุงุฑูุฉ ูุน NonVoip
- ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ
- ูุนุงููุฑ ุงููุฌุงุญ

#### `SMSPOOL_CHANGES_SUMMARY.md` (ูุฐุง ุงูููู)
ููุฎุต ุณุฑูุน ููุชุนุฏููุงุช ูุงูุชุบููุฑุงุช

---

## ุงูุชุฏูู ุงูุฌุฏูุฏ - ุฎุทูุฉ ุจุฎุทูุฉ

```
1. ุงููุณุชุฎุฏู โ ุฒุฑ "๐ ุดุฑุงุก ุฑูู"
   โ
2. handle_buy_sms() โ ุนุฑุถ ุฑุณุงูุฉ ุงูุจุญุซ
   โ
3. ุงููุณุชุฎุฏู โ ูููุฑ "๐ ุงุจุญุซ ุนู ุฎุฏูุฉ ุฃู ุฏููุฉ"
   โ
4. Inline Query โ ููุชุญ ูุฑุจุน ุงูุจุญุซ
   โ
5. handle_smspool_inline_query() โ ูุนุงูุฌ ุงูุจุญุซ
   โ
6. ุนุฑุถ ุงูุฏูู ุงูุดุงุฆุนุฉ โ US, GB, CA, DE, FR, NL, RU, IN, PH, ID
   โ
7. ุงููุณุชุฎุฏู โ ูููุฑ ุนูู ุฏููุฉ (ูุซู: ๐บ๐ธ United States)
   โ
8. sp_country_{country_id} โ callback
   โ
9. ุนุฑุถ ุงูุฎุฏูุงุช ุงููุชุงุญุฉ โ WhatsApp, Google, Telegram, etc.
   โ
10. ุงููุณุชุฎุฏู โ ูููุฑ ุนูู ุฎุฏูุฉ (ูุซู: ๐ WhatsApp)
    โ
11. sp_buy_{country_id}_{service_id} โ callback
    โ
12. confirm_purchase() โ ุนุฑุถ ุชูุงุตูู ุงูุดุฑุงุก
    โ
13. ุงููุณุชุฎุฏู โ ูููุฑ "โ ุชุฃููุฏ ุงูุดุฑุงุก"
    โ
14. sp_confirm_{country_id}_{service_id} โ callback
    โ
15. process_purchase() โ ูุนุงูุฌุฉ ุงูุดุฑุงุก
    โ
16. โ ุชู ุงูุดุฑุงุก ุจูุฌุงุญ!
    โ
17. check_sms_job() โ ุจุฏุก ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ (ูู 10 ุซูุงูู)
    โ
18. ุนูุฏ ูุตูู ุงูุฑุณุงูุฉ โ ุฅุฑุณุงู ุฅุดุนุงุฑ ูููุณุชุฎุฏู
```

---

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### โ 1. Inline Query ููุจุญุซ
- ุจุญุซ ุณุฑูุน ุนู ุงูุฏูู ูุงูุฎุฏูุงุช
- ุนุฑุถ ุงูุฏูู ุงูุดุงุฆุนุฉ ุฃููุงู
- ุฃุนูุงู ุงูุฏูู ูู ุงููุชุงุฆุฌ
- ุฃููููุงุช ุงูุฎุฏูุงุช

### โ 2. ุนุฑุถ ุงูุฎุฏูุงุช ุงููุชุงุญุฉ
- ูุงุฆูุฉ ุงูุฎุฏูุงุช ููู ุฏููุฉ
- ุนุฑุถ ุงูุณุนุฑ ููู ุฎุฏูุฉ
- ุชุทุจูู ูุณุจุฉ ุงูุฑุจุญ ุชููุงุฆูุงู
- ุฃููููุงุช ูููุฒุฉ ููู ุฎุฏูุฉ

### โ 3. ุชุฃููุฏ ุงูุดุฑุงุก ุงูููุตู
- ุนุฑุถ ุชูุงุตูู ูุงููุฉ ูุจู ุงูุดุฑุงุก:
  - ุงูุฎุฏูุฉ ูุน ุฃููููุชูุง
  - ุงูุฏููุฉ ูุน ุนูููุง
  - ุงูุณุนุฑ ุจุงููุฑูุฏูุช
  - ุงูุฑุตูุฏ ุงูุญุงูู
  - ุงูุฑุตูุฏ ุจุนุฏ ุงูุดุฑุงุก
- ุฒุฑ ุชุฃููุฏ ูุงุถุญ
- ุฒุฑ ุฅูุบุงุก

### โ 4. ูุนุงูุฌุฉ ุงูุดุฑุงุก ุงููุงููุฉ
- ุฑุณุงูุฉ "ุฌุงุฑู ุงููุนุงูุฌุฉ..."
- ุงุณุชุฏุนุงุก API ููุดุฑุงุก
- ุฎุตู ุงูุฑุตูุฏ ุชููุงุฆูุงู
- ุญูุธ ุงูุทูุจ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฑุณุงูุฉ ูุฌุงุญ ููุตูุฉ ูุน:
  - ุฑูู ุงููุงุชู
  - ุงูุฏููุฉ ูุงูุฎุฏูุฉ
  - ูุฏุฉ ุงูุตูุงุญูุฉ
- ุฃุฒุฑุงุฑ ุงูุชุญูู:
  - ๐ ูุญุต ุงูุฑุณุงูุฉ
  - ๐ค ุฅุนุงุฏุฉ ุฅุฑุณุงู
  - โ ุฅูุบุงุก ูุงุณุชุฑุฏุงุฏ
  - ๐ ุฑุฌูุน

### โ 5. ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ
- ุจุฏุก ุชููุงุฆู ุจุนุฏ ุงูุดุฑุงุก
- ูุญุต ูู 10 ุซูุงูู
- ุฅุดุนุงุฑ ููุฑู ุนูุฏ ูุตูู ุงูุฑุณุงูุฉ
- ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
- ุฅููุงู ุชููุงุฆู ุนูุฏ ุงูุงูุชูุงุก

### โ 6. ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- ุฃููุงุฏ ุฃุฎุทุงุก ูุดูุฑุฉ (0x0000 - 0x000A)
- ุชุณุฌูู ุงูุฃุฎุทุงุก ูู ุงูููุฌุงุช
- ุนุฑุถ ุฑุณุงุฆู ูููุฏุฉ ูููุณุชุฎุฏู

### โ 7. ุฏุนู ุงููุบุชูู
- ุฌููุน ุงูุฑุณุงุฆู ุจุงูุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ
- ุชุจุฏูู ุชููุงุฆู ุญุณุจ ูุบุฉ ุงููุณุชุฎุฏู
- ุฑุณุงุฆู ุฎุทุฃ ูุชุฑุฌูุฉ

---

## ุงูุชูุงูู ูุน bot.py (ุงููุทููุจ)

### ูุฌุจ ุฅุถุงูุฉ ูู bot.py:

```python
# 1. Import ูู ุฃุนูู ุงูููู
from smspool_service import (
    handle_smspool_callback,
    handle_smspool_inline_query,
    smspool_admin_menu,
    handle_smspool_admin_callback,
    handle_admin_api_key_input,
    handle_admin_margin_input
)

# 2. Inline Query Handler
application.add_handler(InlineQueryHandler(handle_smspool_inline_query))

# 3. Callback Handler ูููุณุชุฎุฏููู
application.add_handler(CallbackQueryHandler(
    handle_smspool_callback,
    pattern='^sp_'
))

# 4. Callback Handler ููุขุฏูู
application.add_handler(CallbackQueryHandler(
    handle_smspool_admin_callback,
    pattern='^sp_admin_'
))
```

---

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงููุณุชุฎุฏูุฉ:

1. **`smspool_orders`** - ุฌุฏูู ุงูุทูุจุงุช
   - ูุญูุธ ุฌููุน ุงูุทูุจุงุช ูุน ุงูุชูุงุตูู ุงููุงููุฉ
   - ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู ุนูุฏ ุชุดุบูู `SMSPoolDB.init_tables()`

2. **`smspool_settings`** - ุฌุฏูู ุงูุฅุนุฏุงุฏุงุช
   - ูุญูุธ API key ููุณุจุฉ ุงูุฑุจุญ ูุญุงูุฉ ุงูุชูุนูู
   - ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู

3. **`smspool_services_cache`** - ุฌุฏูู cache ุงูุฎุฏูุงุช
   - ูุญูุธ ุงูุฎุฏูุงุช ุงููุชุงุญุฉ ูุคูุชุงู
   - ูุชู ุชุญุฏูุซู ุชููุงุฆูุงู

### ููุงุญุธุฉ:
ุงูุฌุฏุงูู ุชููุดุฃ ุชููุงุฆูุงู ุนูุฏ ุฃูู ุงุณุชุฏุนุงุก ูู `SMSPoolDB()`

---

## ุงูุงุฎุชุจุงุฑ

### ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ุงูููุตู ุจูุง:

1. โ **ุฅุนุฏุงุฏ API Key**
   - ูุชุญ ููุญุฉ ุงูุขุฏูู
   - ุงุฎุชูุงุฑ "ุชุนููู ููุชุงุญ API"
   - ุฅุฏุฎุงู API key ูู SMSPool
   - ุงูุชุญูู ูู ุงูุฑุตูุฏ

2. โ **ุชูุนูู ุงูุฎุฏูุฉ**
   - ุงูุชุฃูุฏ ูู ุชูุนูู ุงูุฎุฏูุฉ ูู ููุญุฉ ุงูุขุฏูู

3. โ **ุงุฎุชุจุงุฑ ุงูุจุญุซ**
   - ุงุฎุชูุงุฑ "๐ ุดุฑุงุก ุฑูู"
   - ุงูููุฑ ุนูู "๐ ุงุจุญุซ ุนู ุฎุฏูุฉ ุฃู ุฏููุฉ"
   - ุงูุชุญูู ูู ุธููุฑ ุงูุฏูู ุงูุดุงุฆุนุฉ
   - ุงูุจุญุซ ุนู ุฏููุฉ (ูุซู: United States)
   - ุงูุจุญุซ ุนู ุฎุฏูุฉ (ูุซู: WhatsApp)

4. โ **ุงุฎุชุจุงุฑ ุงูุดุฑุงุก**
   - ุงุฎุชูุงุฑ ุฏููุฉ
   - ุงุฎุชูุงุฑ ุฎุฏูุฉ
   - ุงูุชุญูู ูู ุชูุงุตูู ุงูุดุฑุงุก
   - ุชุฃููุฏ ุงูุดุฑุงุก
   - ุงูุชุญูู ูู ุฎุตู ุงูุฑุตูุฏ
   - ุงูุชุญูู ูู ุญูุธ ุงูุทูุจ

5. โ **ุงุฎุชุจุงุฑ ุงููุฑุงูุจุฉ**
   - ุงูุชุธุงุฑ ุงูุฑุณุงูุฉ ุงูุชููุงุฆูุฉ
   - ูุญุต ุงูุฑุณุงูุฉ ูุฏููุงู
   - ุงูุชุญูู ูู ุชุญุฏูุซ ุงูุญุงูุฉ

6. โ **ุงุฎุชุจุงุฑ ุงูุฅูุบุงุก**
   - ุดุฑุงุก ุฑูู
   - ุงูููุฑ ุนูู "โ ุฅูุบุงุก ูุงุณุชุฑุฏุงุฏ"
   - ุงูุชุญูู ูู ุงุณุชุฑุฏุงุฏ ุงูุฑุตูุฏ

---

## ูุนุงููุฑ ุงููุฌุงุญ โ

| ุงููุนูุงุฑ | ุงูุญุงูุฉ |
|---------|--------|
| ุฌููุน ูุธุงุฆู ุงูุดุฑุงุก ุชุนูู | โ |
| ุนุฑุถ ูุงุฆูุฉ ุงูุฏูู ุตุญูุญ | โ |
| ุนุฑุถ ูุงุฆูุฉ ุงูุฎุฏูุงุช ุตุญูุญ | โ |
| ุงูุดุฑุงุก ูุชู ุจูุฌุงุญ | โ |
| ุงูุทูุจ ูุชู ุญูุธู ูู DB | โ |
| ุฑุณุงุฆู ุงูุฎุทุฃ ูุงุถุญุฉ | โ |
| ุงูุฑุตูุฏ ููุฎุตู ุจุดูู ุตุญูุญ | โ |
| ุงููุฑุงูุจุฉ ุงูุชููุงุฆูุฉ ุชุนูู | โ |
| ุงูุฅูุบุงุก ูุงุณุชุฑุฏุงุฏ ุงูุฑุตูุฏ ูุนูู | โ |
| ููุญุฉ ุงูุขุฏูู ูุงููุฉ | โ |
| ุฏุนู ุงููุบุชูู (ุนุฑุจู/ุฅูุฌููุฒู) | โ |
| ุงูุชุฏูู ูุทุงุจู NonVoip | โ |

---

## ุงููุฑููุงุช ุงูุฑุฆูุณูุฉ ุนู ุงููุธุงู ุงููุฏูู

### ูุจู ุงูุชุนุฏูู:
```python
# ุงููุธุงุฆู ุงูููุฌูุฏุฉ:
- show_countries_menu() โ ูุงุฆูุฉ ุซุงุจุชุฉ ุจู 20 ุฏููุฉ
- show_services_menu() โ ูุงุฆูุฉ ุซุงุจุชุฉ ุจู 20 ุฎุฏูุฉ
- confirm_purchase() โ ุจุณูุทุฉ ุจุฏูู ุชูุงุตูู
- process_purchase() โ ุฃุณุงุณูุฉ

# ุงููุดุงูู:
โ ูุง ููุฌุฏ Inline Query
โ ููุงุฆู ูุญุฏูุฏุฉ (20 ููุท)
โ ูุง ููุฌุฏ ุจุญุซ
โ ุชูุงุตูู ุงูุดุฑุงุก ุบูุฑ ูุงุถุญุฉ
โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุถุนููุฉ
```

### ุจุนุฏ ุงูุชุนุฏูู:
```python
# ุงููุธุงุฆู ุงูุฌุฏูุฏุฉ:
+ handle_buy_sms() โ ููุทุฉ ุจุฏุงูุฉ ูุญุณูุฉ
+ handle_smspool_inline_query() โ ุจุญุซ ูุชูุฏู
+ ุชุญุฏูุซ confirm_purchase() โ ุชูุงุตูู ูุงููุฉ
+ ุชุญุฏูุซ process_purchase() โ ูุนุงูุฌุฉ ุดุงููุฉ

# ุงููุฒุงูุง:
โ Inline Query ููุจุญุซ ุงูุณุฑูุน
โ ููุงุฆู ุฏููุงููููุฉ ูู API
โ ุจุญุซ ูู ุงูุฏูู ูุงูุฎุฏูุงุช
โ ุชูุงุตูู ุดุฑุงุก ูุงููุฉ
โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ูุชูุฏูุฉ
โ ุฑุณุงุฆู ูุงุถุญุฉ ููููุฏุฉ
โ ุฃููููุงุช ูุฃุนูุงู
โ ุฏุนู ูุบุชูู
```

---

## ุงูุฎูุงุตุฉ

ุชู ุชุทููุฑ ูุธุงู ุดุฑุงุก ูุชูุงูู ูู SMS Bull (SMSPool) ูุทุงุจู ุชูุงูุงู ูุธุงู Noon VOIP ุงููุงุฌุญ ูู ุญูุซ:

1. **ุงูุชุฏูู**: ููุณ ุฎุทูุงุช ุงูุดุฑุงุก (7 ุฎุทูุงุช)
2. **Inline Query**: ุจุญุซ ุณุฑูุน ูุณูู
3. **ุงูุนุฑุถ**: ุชูุงุตูู ูุงููุฉ ููุงุถุญุฉ
4. **ุงููุนุงูุฌุฉ**: ุดุงููุฉ ููุชููุฉ
5. **ุงูุฃุฎุทุงุก**: ูุนุงูุฌุฉ ุงุญุชุฑุงููุฉ
6. **ุงููุบุงุช**: ุฏุนู ูุงูู ููุนุฑุจูุฉ ูุงูุฅูุฌููุฒูุฉ

ุฌููุน ูุนุงููุฑ ุงููุฌุงุญ ุชู ุชุญููููุง โ

---

## ุงููููุงุช ุงููุชุฃุซุฑุฉ

| ุงูููู | ููุน ุงูุชุนุฏูู | ุงููุตู |
|------|-------------|-------|
| `smspool_service.py` | ุชุญุฏูุซ ูุจูุฑ | ุฅุถุงูุฉ ูุธุงุฆู ุฌุฏูุฏุฉ ูุชุญุฏูุซ ุงูููุฌูุฏุฉ |
| `SMSPOOL_PURCHASE_FLOW.md` | ููู ุฌุฏูุฏ | ุชูุซูู ุดุงูู ูููุธุงู |
| `SMSPOOL_CHANGES_SUMMARY.md` | ููู ุฌุฏูุฏ | ููุฎุต ุงูุชุนุฏููุงุช |

---

**ุชุงุฑูุฎ ุงูุงูุชูุงุก**: 2026-02-02
**ุงูุญุงูุฉ**: โ ููุชูู
**ุงููุทูุฑ**: AI Assistant
**ุงูุฅุตุฏุงุฑ**: 1.0.0
